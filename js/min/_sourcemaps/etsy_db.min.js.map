{"version":3,"sources":["etsy_db.js"],"names":["$","document","ready","etsyDB","init","Dexie","getDatabaseNames","databases","indexOf","create","db","open","version","stores","products","bins","console","log","listTables","tables","forEach","table","i","name","deleteDB","then","transaction","exportNextTable","shift","toArray","a","result","push","tableName","contents","length","map","t","currentTransaction","addListing","listing","where","equals","listing_id","count","add","bin_id","title","categories","category_path","toString","price","created","creation_tsz","original_creation","original_creation_tsz","getNewProducts","callback","data","getAllProducts","getAllBins","each","bin","id","total","createBin","notes","Materialize","toast","display","updateCounts","deleteBin","bin_name"],"mappings":"AAAAA,EAAEC,UAAUC,MAAM,WACdF,EAAEG,UACFH,EAAEG,OAAOC,KAAO,WACZC,MAAMC,iBAAiB,SAASC,GACO,IAA/BA,EAAUC,QAAQ,UAAiBR,EAAEG,OAAOM,SAC3CT,EAAEU,GAAGC,UAIlBX,EAAEG,OAAOM,OAAS,WACdT,EAAEU,GAAGE,QAAQ,GAAGC,QAERC,SAAU,gFACVC,KAAM,sBAGdC,QAAQC,IAAI,oBACZjB,EAAEU,GAAGC,QAGTX,EAAEG,OAAOe,WAAa,WAClBlB,EAAEU,GAAGS,OAAOC,QAAQ,SAAUC,EAAOC,GACjCN,QAAQC,IAAI,SAAWK,EAAI,KAAOD,EAAME,SAIhDvB,EAAEG,OAAOqB,SAAW,WAChBxB,EAAEU,GAAFV,YAAcyB,KAAK,WACfT,QAAQC,IAAI,uBAIpBjB,EAAEG,OAAFH,UAAkB,WACd,MAAOA,GAAEU,GAAGgB,YAAY,IAAK1B,EAAEU,GAAGS,OAAQ,WAWtC,QAASQ,KACL,GAAIN,GAAQF,EAAOS,OACnB,OAAOP,GAAMQ,UAAUJ,KAAK,SAASK,GAKjC,MAJAC,GAAOC,MACHC,UAAWZ,EAAME,KACjBW,SAAUJ,IAEPX,EAAOgB,OAAS,EACnBR,IACAI,IAjBZ,GAAIZ,GAASnB,EAAEU,GAAGS,OAAOiB,IAAI,SAAUC,GACnC,MAAOhC,OAAMiC,mBAAmBnB,OAAOkB,EAAEd,QAGzCQ,IAEJ,OAAOJ,QAiBf3B,EAAEG,OAAOoC,WAAa,SAASC,GAC3BxC,EAAEU,GAAGW,MAAM,YAAYoB,MAAM,cAAcC,OAAOF,EAAQG,YAAYC,MAAM,SAASA,GACnE,IAAVA,GACA5C,EAAEU,GAAGW,MAAM,YAAYwB,KACnBC,OAAQ,GACRH,WAAYH,EAAQG,WACpBI,MAAOP,EAAQO,MACfC,WAAYR,EAAQS,cAAcC,WAClCC,MAAOX,EAAQW,MACfC,QAASZ,EAAQa,aACjBC,kBAAmBd,EAAQe,wBAC5B9B,KAAK,WACJT,QAAQC,IAAI,kBAAoBuB,EAAQG,iBAQxD3C,EAAEG,OAAOqD,eAAiB,SAASC,GAC/BzD,EAAEU,GAAGW,MAAM,YAAYoB,MAAM,UAAUC,OAAO,IAAIb,UAAUJ,KAAK,SAASiC,GACtED,EAASC,MAIjB1D,EAAEG,OAAOwD,eAAiB,SAASF,GAC/BzD,EAAEU,GAAGW,MAAM,YAAYQ,UAAUJ,KAAK,SAASiC,GAC3CD,EAASC,MAIjB1D,EAAEG,OAAOyD,WAAa,SAASH,GAC3B,GAAI1C,KACJf,GAAEU,GAAGW,MAAM,QAAQwC,KAAK,SAASC,GAC7B9D,EAAEU,GAAGW,MAAM,YAAYoB,MAAM,UAAUC,OAAOoB,EAAIC,IAAInB,MAAM,SAASA,GACjEkB,EAAIE,MAAQpB,EACZ7B,EAAKiB,KAAK8B,OAEfrC,KAAK,WACJgC,EAAS1C,MAIjBf,EAAEG,OAAO8D,UAAY,SAAS1C,EAAM2C,GAChClE,EAAEU,GAAGW,MAAM,QAAQoB,MAAM,QAAQC,OAAOnB,GAAMqB,MAAM,SAASA,GAC3C,IAAVA,EACA5C,EAAEU,GAAGW,MAAM,QAAQwB,KACftB,KAAMA,EACN2C,MAAOA,IACRzC,KAAK,WACJ0C,YAAYC,MAAM,gBAAkB7C,EAAO,gBAAiB,KAC5DvB,EAAEqE,QAAQC,iBAGdH,YAAYC,MAAM,QAAU7C,EAAO,oBAAqB,QAKpEvB,EAAEG,OAAOoE,UAAY,SAASzB,EAAQ0B,GAClCxE,EAAEU,GAAGW,MAAM,QAAQoB,MAAM,MAAMC,OAAOI,GAAtC9C,YAAuDyB,KAAK,WACxD0C,YAAYC,MAAM,QAAUtB,EAAS,OAAS0B,EAAW,wBAAyB","file":"etsy_db.min.js","sourcesContent":["$(document).ready(function() {\n    $.etsyDB = {};\n    $.etsyDB.init = function() {\n        Dexie.getDatabaseNames(function(databases) {\n            if (databases.indexOf('etsyDB') == -1) $.etsyDB.create();\n            else $.db.open();\n        });\n    };\n\n    $.etsyDB.create = function() {\n        $.db.version(1).stores(\n            {\n                products: '++id, bin_id, listing_id, title, categories, price, created, original_created',\n                bins: '++id, name, notes'\n            }\n        );\n        console.log(\"Created database\");\n        $.db.open();\n    };\n\n    $.etsyDB.listTables = function() {\n        $.db.tables.forEach(function (table, i) {\n            console.log('Table ' + i + \": \" + table.name);\n        });\n    };\n\n    $.etsyDB.deleteDB = function() {\n        $.db.delete().then(function() {\n            console.log('Deleted database');\n        });\n    };\n\n    $.etsyDB.export = function() {\n        return $.db.transaction('r', $.db.tables, function() {\n            // Map to transaction-bound table instances because instances in $.db.tables are not bound\n            // to current transaction by default (may change in future versions of Dexie)\n            var tables = $.db.tables.map(function (t) {\n                return Dexie.currentTransaction.tables[t.name];\n            });\n            // Prepare a result: An array of {tableName: \"name\", contents: [objects...]}\n            var result = [];\n            // Recursively export each table:\n            return exportNextTable ();\n\n            function exportNextTable () {\n                var table = tables.shift();\n                return table.toArray().then(function(a) {\n                    result.push({\n                        tableName: table.name,\n                        contents: a\n                    });\n                    return tables.length > 0 ?\n                        exportNextTable() :\n                        result;\n                });\n            }\n        });\n    };\n\n    $.etsyDB.addListing = function(listing) {\n        $.db.table('products').where(\"listing_id\").equals(listing.listing_id).count(function(count) {\n            if (count === 0) {\n                $.db.table('products').add({\n                    bin_id: -1,\n                    listing_id: listing.listing_id,\n                    title: listing.title,\n                    categories: listing.category_path.toString(),\n                    price: listing.price,\n                    created: listing.creation_tsz,\n                    original_creation: listing.original_creation_tsz\n                }).then(function() {\n                    console.log(\"Added listing #\" + listing.listing_id);\n                });\n            } else {\n                //console.log(\"Attempted to add duplicate listing #\" + listing.listing_id + ' - ' + listing.title);\n            }\n        });\n    };\n\n    $.etsyDB.getNewProducts = function(callback) {\n        $.db.table('products').where(\"bin_id\").equals(-1).toArray().then(function(data) {\n            callback(data);\n        });\n    };\n\n    $.etsyDB.getAllProducts = function(callback) {\n        $.db.table('products').toArray().then(function(data) {\n            callback(data);\n        });\n    };\n\n    $.etsyDB.getAllBins = function(callback) {\n        var bins = [];\n        $.db.table('bins').each(function(bin) {\n            $.db.table('products').where(\"bin_id\").equals(bin.id).count(function(count) {\n                bin.total = count;\n                bins.push(bin);\n            });\n        }).then(function() {\n            callback(bins);\n        });\n    };\n\n    $.etsyDB.createBin = function(name, notes) {\n        $.db.table('bins').where(\"name\").equals(name).count(function(count) {\n            if (count === 0) {\n                $.db.table('bins').add({\n                    name: name,\n                    notes: notes\n                }).then(function () {\n                    Materialize.toast(\"Created bin '\" + name + \"' succesfully\", 4000);\n                    $.display.updateCounts();\n                });\n            } else {\n                Materialize.toast(\"Bin '\" + name + \"' already exists!\", 4000);\n            }\n        });\n    };\n\n    $.etsyDB.deleteBin = function(bin_id, bin_name) {\n        $.db.table('bins').where(\"id\").equals(bin_id).delete().then(function() {\n            Materialize.toast('Bin #' + bin_id + \" - '\" + bin_name + \"' deleted succesfully\", 4000);\n        });\n    };\n});\n"],"sourceRoot":"/source/"}