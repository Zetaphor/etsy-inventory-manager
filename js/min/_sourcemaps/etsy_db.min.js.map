{"version":3,"sources":["etsy_db.js"],"names":["$","document","ready","initDB","Dexie","getDatabaseNames","databases","indexOf","createDB","db","open","version","stores","products","bins","console","log","addListing","listing","table","where","equals","listing_id","count","add","bin_id","title","categories","category_path","toString","price","created","creation_tsz","original_creation","original_creation_tsz","then","listTables","tables","forEach","i","name","deleteDatabase","exportDatabase","transaction","exportNextTable","shift","toArray","a","result","push","tableName","contents","length","map","t","currentTransaction"],"mappings":"AAAAA,EAAEC,UAAUC,MAAM,WACdF,EAAEG,OAAS,WACPC,MAAMC,iBAAiB,SAASC,GACO,IAA/BA,EAAUC,QAAQ,UAAiBP,EAAEQ,WACpCR,EAAES,GAAGC,UAIlBV,EAAEQ,SAAW,WACTR,EAAES,GAAGE,QAAQ,GAAGC,QAERC,SAAU,gFACVC,KAAM,sBAGdC,QAAQC,IAAI,oBACZhB,EAAES,GAAGC,QAGTV,EAAEiB,WAAa,SAASC,GACpBlB,EAAES,GAAGU,MAAM,YAAYC,MAAM,cAAcC,OAAOH,EAAQI,YAAYC,MAAM,SAASA,GACnE,IAAVA,EACAvB,EAAES,GAAGU,MAAM,YAAYK,KACnBC,OAAQ,GACRH,WAAYJ,EAAQI,WACpBI,MAAOR,EAAQQ,MACfC,WAAYT,EAAQU,cAAcC,WAClCC,MAAOZ,EAAQY,MACfC,QAASb,EAAQc,aACjBC,kBAAmBf,EAAQgB,wBAC5BC,KAAK,WACJpB,QAAQC,IAAI,kBAAoBE,EAAQI,cAG5CP,QAAQC,IAAI,uCAAyCE,EAAQI,WAAa,MAAQJ,EAAQQ,UAKtG1B,EAAEoC,WAAa,WACXpC,EAAES,GAAG4B,OAAOC,QAAQ,SAAUnB,EAAOoB,GACjCxB,QAAQC,IAAI,SAAWuB,EAAI,KAAOpB,EAAMqB,SAIhDxC,EAAEyC,eAAiB,WACfzC,EAAES,GAAFT,YAAcmC,KAAK,WACfpB,QAAQC,IAAI,uBAIpBhB,EAAE0C,eAAiB,SAASjC,GACxB,MAAOT,GAAES,GAAGkC,YAAY,IAAK3C,EAAES,GAAG4B,OAAQ,WAWtC,QAASO,KACL,GAAIzB,GAAQkB,EAAOQ,OACnB,OAAO1B,GAAM2B,UAAUX,KAAK,SAASY,GAKjC,MAJAC,GAAOC,MACHC,UAAW/B,EAAMqB,KACjBW,SAAUJ,IAEPV,EAAOe,OAAS,EACnBR,IACAI,IAjBZ,GAAIX,GAASrC,EAAES,GAAG4B,OAAOgB,IAAI,SAAUC,GACnC,MAAOlD,OAAMmD,mBAAmBlB,OAAOiB,EAAEd,QAGzCQ,IAEJ,OAAOJ","file":"etsy_db.min.js","sourcesContent":["$(document).ready(function() {\n    $.initDB = function() {\n        Dexie.getDatabaseNames(function(databases) {\n            if (databases.indexOf('etsyDB') == -1) $.createDB();\n            else $.db.open();\n        });\n    };\n\n    $.createDB = function() {\n        $.db.version(1).stores(\n            {\n                products: '++id, bin_id, listing_id, title, categories, price, created, original_created',\n                bins: '++id, name, notes'\n            }\n        );\n        console.log(\"Created database\");\n        $.db.open();\n    };\n\n    $.addListing = function(listing) {\n        $.db.table('products').where(\"listing_id\").equals(listing.listing_id).count(function(count) {\n            if (count === 0) {\n                $.db.table('products').add({\n                    bin_id: -1,\n                    listing_id: listing.listing_id,\n                    title: listing.title,\n                    categories: listing.category_path.toString(),\n                    price: listing.price,\n                    created: listing.creation_tsz,\n                    original_creation: listing.original_creation_tsz\n                }).then(function() {\n                    console.log(\"Added listing #\" + listing.listing_id);\n                });\n            } else {\n                console.log(\"Attempted to add duplicate listing #\" + listing.listing_id + ' - ' + listing.title);\n            }\n        });\n    };\n\n    $.listTables = function() {\n        $.db.tables.forEach(function (table, i) {\n            console.log('Table ' + i + \": \" + table.name);\n        });\n    };\n\n    $.deleteDatabase = function() {\n        $.db.delete().then(function() {\n            console.log('Deleted database');\n        });\n    };\n\n    $.exportDatabase = function(db) {\n        return $.db.transaction('r', $.db.tables, function() {\n            // Map to transaction-bound table instances because instances in $.db.tables are not bound\n            // to current transaction by default (may change in future versions of Dexie)\n            var tables = $.db.tables.map(function (t) {\n                return Dexie.currentTransaction.tables[t.name];\n            });\n            // Prepare a result: An array of {tableName: \"name\", contents: [objects...]}\n            var result = [];\n            // Recursively export each table:\n            return exportNextTable ();\n\n            function exportNextTable () {\n                var table = tables.shift();\n                return table.toArray().then(function(a) {\n                    result.push({\n                        tableName: table.name,\n                        contents: a\n                    });\n                    return tables.length > 0 ?\n                        exportNextTable() :\n                        result;\n                });\n            }\n        });\n    };\n});\n"],"sourceRoot":"/source/"}