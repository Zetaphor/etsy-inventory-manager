{"version":3,"sources":["database.js"],"names":["$","document","ready","initDB","Dexie","getDatabaseNames","databases","indexOf","createDB","db","open","version","stores","products","bins","console","log","listTables","tables","forEach","table","i","name","deleteDatabase","then","exportDatabase","transaction","exportNextTable","shift","toArray","a","result","push","tableName","contents","length","map","t","currentTransaction"],"mappings":"AAAAA,EAAEC,UAAUC,MAAM,WACdF,EAAEG,OAAS,WACPC,MAAMC,iBAAiB,SAASC,GACO,IAA/BA,EAAUC,QAAQ,UAAiBP,EAAEQ,WACpCR,EAAES,GAAGC,UAIlBV,EAAEQ,SAAW,WACTR,EAAES,GAAGE,QAAQ,GAAGC,QAERC,SAAU,gFACVC,KAAM,eAGdC,QAAQC,IAAI,oBACZhB,EAAES,GAAGC,QAGTV,EAAEiB,WAAa,WACXjB,EAAES,GAAGS,OAAOC,QAAQ,SAAUC,EAAOC,GACjCN,QAAQC,IAAI,SAAWK,EAAI,KAAOD,EAAME,SAIhDtB,EAAEuB,eAAiB,WACfvB,EAAES,GAAFT,YAAcwB,KAAK,WACfT,QAAQC,IAAI,uBAIpBhB,EAAEyB,eAAiB,SAAShB,GACxB,MAAOT,GAAES,GAAGiB,YAAY,IAAK1B,EAAES,GAAGS,OAAQ,WAWtC,QAASS,KACL,GAAIP,GAAQF,EAAOU,OACnB,OAAOR,GAAMS,UAAUL,KAAK,SAASM,GAKjC,MAJAC,GAAOC,MACHC,UAAWb,EAAME,KACjBY,SAAUJ,IAEPZ,EAAOiB,OAAS,EACnBR,IACAI,IAjBZ,GAAIb,GAASlB,EAAES,GAAGS,OAAOkB,IAAI,SAAUC,GACnC,MAAOjC,OAAMkC,mBAAmBpB,OAAOmB,EAAEf,QAGzCS,IAEJ,OAAOJ","file":"database.min.js","sourcesContent":["$(document).ready(function() {\n    $.initDB = function() {\n        Dexie.getDatabaseNames(function(databases) {\n            if (databases.indexOf('etsyDB') == -1) $.createDB();\n            else $.db.open();\n        });\n    };\n\n    $.createDB = function() {\n        $.db.version(1).stores(\n            {\n                products: '++id, bin_id, listing_id, title, categories, price, created, original_created',\n                bins: '++id, name'\n            }\n        );\n        console.log(\"Created database\");\n        $.db.open();\n    };\n\n    $.listTables = function() {\n        $.db.tables.forEach(function (table, i) {\n            console.log('Table ' + i + \": \" + table.name);\n        });\n    };\n\n    $.deleteDatabase = function() {\n        $.db.delete().then(function() {\n            console.log('Deleted database');\n        });\n    };\n\n    $.exportDatabase = function(db) {\n        return $.db.transaction('r', $.db.tables, function() {\n            // Map to transaction-bound table instances because instances in $.db.tables are not bound\n            // to current transaction by default (may change in future versions of Dexie)\n            var tables = $.db.tables.map(function (t) {\n                return Dexie.currentTransaction.tables[t.name];\n            });\n            // Prepare a result: An array of {tableName: \"name\", contents: [objects...]}\n            var result = [];\n            // Recursively export each table:\n            return exportNextTable ();\n\n            function exportNextTable () {\n                var table = tables.shift();\n                return table.toArray().then(function(a) {\n                    result.push({\n                        tableName: table.name,\n                        contents: a\n                    });\n                    return tables.length > 0 ?\n                        exportNextTable() :\n                        result;\n                });\n            }\n        });\n    };\n});\n"],"sourceRoot":"/source/"}