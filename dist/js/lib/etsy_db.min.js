$(document).ready(function(){$.etsyDB={init:function(){$.db=new Dexie("etsyDB"),Dexie.getDatabaseNames(function(e){-1==e.indexOf("etsyDB")?$.etsyDB.create():$.db.open()})},create:function(){$.db.version(1).stores({products:"++id, bin_id, bin_name, listing_id, title, categories, price, created, original_created",bins:"++id, name, notes"}),console.log("Created database"),$.db.open()},listTables:function(){$.db.tables.forEach(function(e,t){console.log("Table "+t+": "+e.name)})},"delete":function(){$.db["delete"]().then(function(){console.log("Deleted database"),indexedDB.deleteDatabase("etsyDB")})},"export":function(){return $.db.transaction("r",$.db.tables,function(){function e(){var i=t.shift();return i.toArray().then(function(a){return n.push({tableName:i.name,contents:a}),t.length>0?e():n})}var t=$.db.tables.map(function(e){return Dexie.currentTransaction.tables[e.name]}),n=[];return e()})},products:{add:function(e){$.db.table("products").where("listing_id").equals(e.listing_id).count(function(t){0===t&&$.db.table("products").add({bin_id:-1,bin_name:"None",listing_id:e.listing_id,title:e.title,categories:e.category_path.toString(),price:e.price,created:e.creation_tsz,original_creation:e.original_creation_tsz}).then(function(){console.log("Added listing #"+e.listing_id)})})},setBin:function(e,t,n){e=parseInt(e),t=parseInt(t),$.db.table("bins").where("id").equals(t).toArray().then(function(i){var a=i[0].name;$.db.table("products").update(e,{bin_id:t,bin_name:a}).then(function(i){i?$.db.table("bins").where("id").equals(t).toArray().then(function(){$.display.toastSuccess("Updated product bin successfully"),n(e,t,a)}):$.display.toastSuccess("There was an error updating the product bin!")})})},getNew:function(e){$.db.table("products").where("bin_id").equals(-1).toArray().then(function(t){e(t)})},getAll:function(e){$.db.table("products").toArray().then(function(t){e(t)})}},bins:{getContents:function(e,t){e=parseInt(e),$.db.table("products").where("bin_id").equals(e).toArray().then(function(e){t(e)})},getAll:function(e){var t=[];$.db.table("bins").each(function(e){$.db.table("products").where("bin_id").equals(e.id).count(function(n){e.total=n,t.push(e)})}).then(function(){e(t)})},add:function(e,t,n){$.db.table("bins").where("name").equals(e).count(function(i){0===i?$.db.table("bins").add({name:e,notes:t}).then(function(i){$.display.toastSuccess("Created bin '"+e+"' successfully"),$.display.updateCounts(),n([{id:i,name:e,notes:t}],!0)}):$.display.toastError("Bin '"+e+"' already exists!")})},update:function(e,t,n,i){e=parseInt(e),$.db.table("bins").where("name").equals(t).count(function(a){0===a?$.db.table("bins").update(e,{name:t,notes:n}).then(function(a){a?($.display.toastSuccess("Bin #"+e+" updated successfully"),i({id:e,name:t,notes:n})):$.display.toastError("An error occured while updating bin #"+e)}):$.display.toastError("Error! A bin already exists with the name '"+t+"'")})},"delete":function(e,t,n){e=parseInt(e),$.db.table("bins").where("id").equals(e)["delete"]().then(function(){$.display.toastSuccess("Bin #"+e+" - '"+t+"' deleted successfully"),n(e)})}}}});
//# sourceMappingURL=../sourcemaps/lib/etsy_db.min.js.map